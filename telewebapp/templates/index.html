
{% extends "base.html" %}
{% block content %}
  <form method="post" action="/register">
    <div class="form-row">
      <label for="fio">Выберите своё ФИО (как в таблице):</label>
      <select id="fio" name="fio" required>
        <option value="">— Выберите —</option>
        {% for name in names %}
          <option value="{{ name }}">{{ name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="row">
      <button class="button" type="submit">Привязать</button>
    </div>
  </form>
  {% if error_msg %}
  <div class="flash error">{{ error_msg }}</div>
{% endif %}
<!-- Add to the page that opens inside Telegram WebApp (e.g., index.html) -->
<script>
(function(){
  try{
    const tw = window.Telegram && window.Telegram.WebApp;
    if(!tw || !tw.initDataUnsafe || !tw.initDataUnsafe.user) return;
    const uid = tw.initDataUnsafe.user.id;
    fetch('/api/auth/tg_login2', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      credentials:'include',
      body: JSON.stringify({ user_id: uid })
    })
    .then(r => r.json())
    .then(j => { if(j && j.ok){ window.location.href = '/'; } })
    .catch(()=>{});
  }catch(e){}
})();
</script>

{% endblock %}
